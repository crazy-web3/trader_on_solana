<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•å›¾è¡¨æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .chart-container {
            width: 100%;
            height: 400px;
            margin: 2rem 0;
            border: 2px solid #007bff;
            border-radius: 8px;
            background: #f8f9fa;
            position: relative;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 1rem;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-weight: bold;
            font-size: 1.1rem;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ç®€å•å›¾è¡¨æµ‹è¯•</h1>
        
        <div id="status" class="status info">å‡†å¤‡æµ‹è¯•...</div>
        
        <button class="test-button" onclick="testBasicChart()">åˆ›å»ºåŸºç¡€å›¾è¡¨</button>
        <button class="test-button" onclick="testWithRealData()">ä½¿ç”¨çœŸå®æ•°æ®</button>
        <button class="test-button" onclick="testInVueStyle()">Vueé£æ ¼æµ‹è¯•</button>
        <button class="test-button" onclick="clearAll()">æ¸…ç©ºæ‰€æœ‰</button>
        
        <div id="chartContainer" class="chart-container">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #666;">
                <h3>ğŸ“Š å›¾è¡¨åŒºåŸŸ</h3>
                <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•</p>
            </div>
        </div>
        
        <div id="logs" style="background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 1rem; margin: 1rem 0; font-family: monospace; font-size: 0.9rem; max-height: 200px; overflow-y: auto;"></div>
    </div>

    <script>
        let currentChart = null;
        let logContainer = document.getElementById('logs');

        function log(message) {
            console.log(message);
            logContainer.innerHTML += message + '\n';
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearAll() {
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
            document.getElementById('chartContainer').innerHTML = `
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #666;">
                    <h3>ğŸ“Š å›¾è¡¨åŒºåŸŸ</h3>
                    <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•</p>
                </div>
            `;
            logContainer.innerHTML = '';
            updateStatus('å·²æ¸…ç©ºæ‰€æœ‰å†…å®¹');
        }

        function testBasicChart() {
            try {
                updateStatus('å¼€å§‹åˆ›å»ºåŸºç¡€å›¾è¡¨...', 'info');
                
                log('1. æ£€æŸ¥Chart.jså¯ç”¨æ€§...');
                if (typeof Chart === 'undefined') {
                    throw new Error('Chart.jsæœªåŠ è½½');
                }
                log('âœ… Chart.jså·²åŠ è½½');

                log('2. é”€æ¯ç°æœ‰å›¾è¡¨...');
                if (currentChart) {
                    currentChart.destroy();
                    currentChart = null;
                    log('âœ… ç°æœ‰å›¾è¡¨å·²é”€æ¯');
                }

                log('3. åˆ›å»ºcanvaså…ƒç´ ...');
                const container = document.getElementById('chartContainer');
                container.innerHTML = '<canvas id="testChart" width="800" height="400" style="width: 100%; height: 100%;"></canvas>';
                const canvas = document.getElementById('testChart');
                const ctx = canvas.getContext('2d');
                log('âœ… Canvaså…ƒç´ å·²åˆ›å»º');

                log('4. å‡†å¤‡æµ‹è¯•æ•°æ®...');
                const data = {
                    labels: ['ç‚¹1', 'ç‚¹2', 'ç‚¹3', 'ç‚¹4', 'ç‚¹5'],
                    datasets: [{
                        label: 'æµ‹è¯•çº¿',
                        data: [10, 20, 15, 25, 30],
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                };
                log('âœ… æµ‹è¯•æ•°æ®å·²å‡†å¤‡');

                log('5. åˆ›å»ºChartå®ä¾‹...');
                currentChart = new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                log('âœ… Chartå®ä¾‹å·²åˆ›å»º');

                updateStatus('âœ… åŸºç¡€å›¾è¡¨åˆ›å»ºæˆåŠŸï¼', 'success');
                log(`å›¾è¡¨ID: ${currentChart.id}`);
                log(`æ•°æ®ç‚¹æ•°é‡: ${data.datasets[0].data.length}`);

            } catch (error) {
                updateStatus(`âŒ åŸºç¡€å›¾è¡¨åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
                log(`é”™è¯¯è¯¦æƒ…: ${error.stack}`);
            }
        }

        function testWithRealData() {
            try {
                updateStatus('å¼€å§‹ä½¿ç”¨çœŸå®æ•°æ®åˆ›å»ºå›¾è¡¨...', 'info');
                
                log('1. æ£€æŸ¥Chart.jså¯ç”¨æ€§...');
                if (typeof Chart === 'undefined') {
                    throw new Error('Chart.jsæœªåŠ è½½');
                }

                log('2. é”€æ¯ç°æœ‰å›¾è¡¨...');
                if (currentChart) {
                    currentChart.destroy();
                    currentChart = null;
                }

                log('3. åˆ›å»ºcanvaså…ƒç´ ...');
                const container = document.getElementById('chartContainer');
                container.innerHTML = '<canvas id="testChart" width="800" height="400" style="width: 100%; height: 100%;"></canvas>';
                const canvas = document.getElementById('testChart');
                const ctx = canvas.getContext('2d');

                log('4. ç”Ÿæˆæ¨¡æ‹Ÿæƒç›Šæ›²çº¿æ•°æ®...');
                const equityData = [];
                const timestamps = [];
                let equity = 10000;
                const now = Date.now();
                
                for (let i = 0; i < 50; i++) {
                    equity += (Math.random() - 0.5) * 200;
                    equityData.push(Math.round(equity * 100) / 100);
                    timestamps.push(now - (50 - i) * 60 * 60 * 1000);
                }

                const labels = timestamps.map((ts, index) => {
                    if (index % 5 === 0) {
                        const date = new Date(ts);
                        return date.toLocaleDateString('zh-CN');
                    }
                    return '';
                });

                log(`âœ… ç”Ÿæˆäº†${equityData.length}ä¸ªæ•°æ®ç‚¹`);
                log(`èµ·å§‹èµ„é‡‘: $${equityData[0]}`);
                log(`æœ€ç»ˆèµ„é‡‘: $${equityData[equityData.length-1]}`);

                log('5. åˆ›å»ºæƒç›Šæ›²çº¿å›¾è¡¨...');
                currentChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'æƒç›Šæ›²çº¿',
                            data: equityData,
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.1,
                            pointRadius: 0,
                            pointHoverRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + Math.round(value).toLocaleString();
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    maxTicksLimit: 8
                                }
                            }
                        }
                    }
                });

                updateStatus('âœ… çœŸå®æ•°æ®å›¾è¡¨åˆ›å»ºæˆåŠŸï¼', 'success');
                log('âœ… æƒç›Šæ›²çº¿å›¾è¡¨åˆ›å»ºå®Œæˆ');

            } catch (error) {
                updateStatus(`âŒ çœŸå®æ•°æ®å›¾è¡¨åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
                log(`é”™è¯¯è¯¦æƒ…: ${error.stack}`);
            }
        }

        function testInVueStyle() {
            try {
                updateStatus('å¼€å§‹Vueé£æ ¼æµ‹è¯•...', 'info');
                
                log('1. æ¨¡æ‹ŸVueç»„ä»¶çš„å›¾è¡¨åˆ›å»ºè¿‡ç¨‹...');
                
                // æ¨¡æ‹ŸVueçš„æ•°æ®
                const mockResult = {
                    equity_curve: [10000, 10150, 9980, 10200, 10050, 10300, 10180, 10400, 10250, 10500],
                    timestamps: [
                        Date.now() - 9 * 60 * 60 * 1000,
                        Date.now() - 8 * 60 * 60 * 1000,
                        Date.now() - 7 * 60 * 60 * 1000,
                        Date.now() - 6 * 60 * 60 * 1000,
                        Date.now() - 5 * 60 * 60 * 1000,
                        Date.now() - 4 * 60 * 60 * 1000,
                        Date.now() - 3 * 60 * 60 * 1000,
                        Date.now() - 2 * 60 * 60 * 1000,
                        Date.now() - 1 * 60 * 60 * 1000,
                        Date.now()
                    ]
                };

                log('2. æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§...');
                if (mockResult.equity_curve.length !== mockResult.timestamps.length) {
                    throw new Error(`æ•°æ®é•¿åº¦ä¸ä¸€è‡´: equity_curve=${mockResult.equity_curve.length}, timestamps=${mockResult.timestamps.length}`);
                }
                log('âœ… æ•°æ®é•¿åº¦ä¸€è‡´');

                log('3. é”€æ¯ç°æœ‰å›¾è¡¨...');
                if (currentChart) {
                    currentChart.destroy();
                    currentChart = null;
                }

                log('4. åˆ›å»ºcanvas (Vueé£æ ¼)...');
                const container = document.getElementById('chartContainer');
                container.innerHTML = '';
                const canvas = document.createElement('canvas');
                canvas.width = 800;
                canvas.height = 400;
                canvas.style.width = '100%';
                canvas.style.height = '100%';
                container.appendChild(canvas);
                const ctx = canvas.getContext('2d');

                log('5. å‡†å¤‡æ ‡ç­¾...');
                const labels = mockResult.timestamps.map(ts => {
                    const date = new Date(ts);
                    return date.toLocaleString('zh-CN', { month: '2-digit', day: '2-digit', hour: '2-digit' });
                });

                log('6. åˆ›å»ºå›¾è¡¨é…ç½®...');
                const config = {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'æƒç›Šæ›²çº¿',
                            data: mockResult.equity_curve,
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.1,
                            pointRadius: 0,
                            pointHoverRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + Math.round(value).toLocaleString();
                                    }
                                }
                            },
                            x: {
                                ticks: {
                                    maxTicksLimit: 8
                                }
                            }
                        }
                    }
                };

                log('7. åˆ›å»ºChartå®ä¾‹...');
                currentChart = new Chart(ctx, config);

                updateStatus('âœ… Vueé£æ ¼æµ‹è¯•æˆåŠŸï¼', 'success');
                log('âœ… Vueé£æ ¼å›¾è¡¨åˆ›å»ºå®Œæˆ');
                log(`æœ€ç»ˆæ”¶ç›Š: $${mockResult.equity_curve[mockResult.equity_curve.length-1] - mockResult.equity_curve[0]}`);

            } catch (error) {
                updateStatus(`âŒ Vueé£æ ¼æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                log(`é”™è¯¯è¯¦æƒ…: ${error.stack}`);
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç¯å¢ƒ
        document.addEventListener('DOMContentLoaded', function() {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            log(`Chart.jså¯ç”¨æ€§: ${typeof Chart !== 'undefined' ? 'âœ…' : 'âŒ'}`);
            log(`æµè§ˆå™¨: ${navigator.userAgent}`);
            log(`æ—¶é—´: ${new Date().toLocaleString()}`);
            
            if (typeof Chart !== 'undefined') {
                updateStatus('âœ… ç¯å¢ƒæ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•', 'success');
            } else {
                updateStatus('âŒ Chart.jsæœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
            }
        });
    </script>
</body>
</html>