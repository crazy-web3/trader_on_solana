<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒç›Šæ›²çº¿æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .chart-container {
            min-height: 400px;
            height: 400px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            margin: 2rem 0;
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .debug-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.9rem;
            border: 1px solid #e0e0e0;
        }

        .status {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin: 0.5rem 0;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ˆ æƒç›Šæ›²çº¿æ˜¾ç¤ºæµ‹è¯•</h1>
        
        <div class="controls">
            <button class="btn btn-primary" onclick="testSimpleChart()">æµ‹è¯•ç®€å•å›¾è¡¨</button>
            <button class="btn btn-primary" onclick="testEquityCurve()">æµ‹è¯•æƒç›Šæ›²çº¿</button>
            <button class="btn btn-secondary" onclick="debugChart()">è°ƒè¯•ä¿¡æ¯</button>
            <button class="btn btn-secondary" onclick="clearChart()">æ¸…ç©ºå›¾è¡¨</button>
        </div>

        <div id="status"></div>

        <div class="chart-container" id="chartContainer">
            <p style="text-align: center; color: #666; margin-top: 150px;">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
        </div>

        <div class="debug-info" id="debugInfo">
            <strong>è°ƒè¯•ä¿¡æ¯:</strong><br>
            Chart.js çŠ¶æ€: <span id="chartStatus">æ£€æŸ¥ä¸­...</span><br>
            å®¹å™¨å…ƒç´ : <span id="containerStatus">æ£€æŸ¥ä¸­...</span><br>
            æœ€åæ“ä½œ: <span id="lastAction">æ— </span>
        </div>
    </div>

    <script>
        let chart = null;

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function updateDebugInfo() {
            document.getElementById('chartStatus').textContent = typeof Chart !== 'undefined' ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½';
            document.getElementById('containerStatus').textContent = document.getElementById('chartContainer') ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨';
        }

        function testSimpleChart() {
            document.getElementById('lastAction').textContent = 'æµ‹è¯•ç®€å•å›¾è¡¨';
            updateStatus('å¼€å§‹åˆ›å»ºç®€å•å›¾è¡¨...', 'info');
            
            try {
                if (typeof Chart === 'undefined') {
                    throw new Error('Chart.js æœªåŠ è½½');
                }

                const container = document.getElementById('chartContainer');
                if (!container) {
                    throw new Error('å›¾è¡¨å®¹å™¨ä¸å­˜åœ¨');
                }

                // æ¸…ç©ºå®¹å™¨
                container.innerHTML = '';

                // åˆ›å»ºcanvas
                const canvas = document.createElement('canvas');
                canvas.width = 800;
                canvas.height = 400;
                canvas.style.width = '100%';
                canvas.style.height = '400px';
                container.appendChild(canvas);

                // é”€æ¯ç°æœ‰å›¾è¡¨
                if (chart) {
                    chart.destroy();
                    chart = null;
                }

                // åˆ›å»ºç®€å•æ•°æ®
                const data = [10000, 10050, 10100, 10080, 10120, 10150, 10200, 10180, 10250];
                const labels = data.map((_, index) => `Day ${index + 1}`);

                // åˆ›å»ºå›¾è¡¨
                const ctx = canvas.getContext('2d');
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'ç®€å•æµ‹è¯•æ•°æ®',
                            data: data,
                            borderColor: '#007bff',
                            backgroundColor: '#007bff20',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });

                updateStatus('âœ… ç®€å•å›¾è¡¨åˆ›å»ºæˆåŠŸï¼', 'success');
            } catch (error) {
                updateStatus(`âŒ ç®€å•å›¾è¡¨åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
                console.error('Simple chart error:', error);
            }
        }

        function testEquityCurve() {
            document.getElementById('lastAction').textContent = 'æµ‹è¯•æƒç›Šæ›²çº¿';
            updateStatus('å¼€å§‹åˆ›å»ºæƒç›Šæ›²çº¿...', 'info');
            
            try {
                if (typeof Chart === 'undefined') {
                    throw new Error('Chart.js æœªåŠ è½½');
                }

                const container = document.getElementById('chartContainer');
                if (!container) {
                    throw new Error('å›¾è¡¨å®¹å™¨ä¸å­˜åœ¨');
                }

                // æ¸…ç©ºå®¹å™¨
                container.innerHTML = '';

                // åˆ›å»ºcanvas
                const canvas = document.createElement('canvas');
                canvas.width = 800;
                canvas.height = 400;
                canvas.style.width = '100%';
                canvas.style.height = '400px';
                container.appendChild(canvas);

                // é”€æ¯ç°æœ‰å›¾è¡¨
                if (chart) {
                    chart.destroy();
                    chart = null;
                }

                // æ¨¡æ‹Ÿæƒç›Šæ›²çº¿æ•°æ®
                const equityData = [
                    10000, 9990.14, 9992.66, 9990.00, 9990.55, 9991.19, 9993.06, 9996.13, 9994.05, 9991.80,
                    9989.88, 9988.21, 9988.19, 9984.10, 9987.25, 9987.54, 9988.88, 9986.53, 9990.95, 9991.39,
                    9987.91, 9987.51, 9989.37, 9989.50, 9989.94, 9987.50, 9989.91, 9991.34, 9997.49, 9994.97
                ];

                const timestamps = equityData.map((_, index) => {
                    const date = new Date();
                    date.setDate(date.getDate() - (equityData.length - index));
                    return date.toLocaleDateString('zh-CN');
                });

                // åˆ›å»ºæ ‡ç­¾ï¼ˆåªæ˜¾ç¤ºéƒ¨åˆ†ï¼‰
                const labels = timestamps.map((ts, index) => {
                    if (index % Math.ceil(timestamps.length / 8) === 0) {
                        return ts;
                    }
                    return '';
                });

                // åˆ›å»ºå›¾è¡¨
                const ctx = canvas.getContext('2d');
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'æƒç›Šæ›²çº¿',
                            data: equityData,
                            borderColor: '#00e5ff',
                            backgroundColor: '#00e5ff20',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.1,
                            pointRadius: 0,
                            pointHoverRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    color: '#333'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                ticks: {
                                    color: '#333',
                                    callback: function(value) {
                                        return '$' + Math.round(value).toLocaleString();
                                    }
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                ticks: {
                                    color: '#333',
                                    maxTicksLimit: 8
                                }
                            }
                        }
                    }
                });

                updateStatus('âœ… æƒç›Šæ›²çº¿åˆ›å»ºæˆåŠŸï¼', 'success');
            } catch (error) {
                updateStatus(`âŒ æƒç›Šæ›²çº¿åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
                console.error('Equity curve error:', error);
            }
        }

        function debugChart() {
            document.getElementById('lastAction').textContent = 'è°ƒè¯•å›¾è¡¨';
            console.log('=== Chart Debug Info ===');
            console.log('Chart.js available:', typeof Chart !== 'undefined');
            console.log('Container element:', document.getElementById('chartContainer'));
            console.log('Current chart:', chart);
            console.log('DOM ready:', document.readyState);
            console.log('========================');
            
            updateStatus('è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°', 'info');
        }

        function clearChart() {
            document.getElementById('lastAction').textContent = 'æ¸…ç©ºå›¾è¡¨';
            const container = document.getElementById('chartContainer');
            if (container) {
                container.innerHTML = '<p style="text-align: center; color: #666; margin-top: 150px;">å›¾è¡¨å·²æ¸…ç©º</p>';
            }
            
            if (chart) {
                chart.destroy();
                chart = null;
            }
            
            updateStatus('å›¾è¡¨å·²æ¸…ç©º', 'info');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateDebugInfo();
            updateStatus('é¡µé¢åŠ è½½å®Œæˆï¼ŒChart.js çŠ¶æ€: ' + (typeof Chart !== 'undefined' ? 'å·²åŠ è½½' : 'æœªåŠ è½½'), 'info');
        });

        // å®šæœŸæ›´æ–°è°ƒè¯•ä¿¡æ¯
        setInterval(updateDebugInfo, 1000);
    </script>
</body>
</html>